ðŸ§¾ Accounting Module (General Ledger)

Tasks:
	1.	Journal Entry Generation
	â€¢	Auto-post journal entries on:
	â€¢	AP invoice approval
	â€¢	AR invoice issuance
	â€¢	Activity actual cost submission
	â€¢	Intercompany transactions
	â€¢	Enforce balanced debits and credits
	2.	Account Mapping Engine
	â€¢	Map activity categories or cost lines to GL accounts
	â€¢	Support hierarchical fallback (activity â†’ category â†’ default)
	3.	Period Validation
	â€¢	Ensure entries fall within open fiscal periods
	â€¢	Add logic to lock periods post close
	4.	Auto-posting Triggers
	â€¢	Hook into actual_costs, change_order_lines, ap_invoices, ar_invoices
	â€¢	Determine appropriate journal type and structure
	5.	Transaction Audit Trail
	â€¢	Link journal entries to source documents (cost_line_id, invoice_id, etc.)
	â€¢	Include tenant_id and user tracking

ðŸ”— Interactions:
	â€¢	Pull activity â†’ category â†’ GL account mapping
	â€¢	Post actuals from activities as journaled costs

â¸»

ðŸ’¸ Accounts Payable (AP)

Tasks:
	1.	Invoice Approval Workflow
	â€¢	Add status transitions: draft â†’ approved â†’ posted
	â€¢	Prevent posting unless all lines are mapped to accounts
	2.	Cost Line Integration
	â€¢	Tie invoice lines to cost lines or activity actuals
	â€¢	Validate total amounts and match budget
	3.	GL Posting
	â€¢	On approval: post to AP liability and expense accounts
	â€¢	Optionally post to WIP or prepay accounts (based on vendor or cost type)
	4.	Vendor Balances
	â€¢	Update vendor ledger and aging schedules
	â€¢	Trigger payment due tracking logic
	5.	Elimination Logic
	â€¢	If vendor is an internal company, post intercompany entries instead

ðŸ”— Interactions:
	â€¢	Attach AP invoice lines to cost_lines (source = vendor)
	â€¢	Reference activities to validate which project_unit_budget theyâ€™re hitting

â¸»

ðŸ’° Accounts Receivable (AR)

Tasks:
	1.	Invoice Generation
	â€¢	Manual or system-generated (e.g., billing schedule)
	â€¢	Link AR invoices to activities, milestones, or schedules
	2.	Revenue Recognition
	â€¢	Use activity completion % or actual cost thresholds
	â€¢	Recognize revenue upon billing or completion depending on accounting method
	3.	GL Posting
	â€¢	Debit A/R, credit revenue accounts
	â€¢	Auto-post on invoice issue or receipt of payment
	4.	Client Balances
	â€¢	Track aging
	â€¢	Allow partial payments and credit memos
	5.	Cash Application
	â€¢	On payment, clear A/R and apply to specific invoice(s)

ðŸ”— Interactions:
	â€¢	Pull activity % complete or cost incurred for billing logic
	â€¢	Derive billing unit or contract value from project_unit_budgets

â¸»

ðŸ§© Shared Infrastructure Requirements
	â€¢	Status Engine for workflows (draft â†’ approved â†’ posted)
	â€¢	Mapping Table: activity/category â†’ GL account
	â€¢	Document â†” Journal Linkage (foreign keys with audit logging)
	â€¢	Validation Middleware in controllers to enforce transitions and posting rules
	â€¢	Scheduler (Phase 6) for AR recurring billing and period-end automation